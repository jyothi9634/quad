<?php $commoncomponent = app('App\Components\CommonComponent'); ?>
<div id="news-feed" class="tab-pane fade in active">
    
   <?php echo $__env->make('networks/newsfeed/posting', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
   
   <div class="clearfix"></div>
   <div class="news-feed">
      
      <?php echo $__env->make('networks/newsfeed/filter-form', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
      
      <!-- Feed Block -->
      <div class="col-md-12 feed-block padding-right-none" id="feedDispBlk">
      <?php if(count($networkFeeds)): ?>
         <div id="article_posts">
         <?php /* Check and display the feeds of all three types : Start */ ?>
         <?php foreach($networkFeeds as $feed): ?>

          <?php /* Single Feed Block */ ?>
          <div class="clsFeedSingleBlk">
            <div class="col-md-1 padding-none">
               <div class="profile-pic">
               <?php if($feed->lkp_role_id == 2): ?>
   				<?php /**/ $url = "uploads/seller/$feed->userid/" /**/ ?>
   	        <?php else: ?>
   	        	<?php /**/ $url = "uploads/buyer/$feed->userid/" /**/ ?>
   	        <?php endif; ?>
   	         <?php /**/ $getuserpic = $url.$feed->user_pic /**/ ?>
               	<?php /**/ $userpic =  $commoncomponent::str_replace_last( '.' , '_94_92.' , $getuserpic ) /**/ ?>
               	<?php if(file_exists($getuserpic)): ?>
               	<img src="<?php echo e(url($userpic)); ?>"/>
               	<?php else: ?>
               	<i class="fa fa-user"></i>
               	<?php endif; ?>
               </div>
            </div>
            <div class="col-md-11 padding-right-none">
               <div class="col-md-12 feed-info">
                  <span class="user-name">
                  <?php /* ********************* Shared feed ********************* */ ?>
                     <?php if($feed->feed_type == 'share'): ?>
                        <strong>Shared by <a href="<?php echo e(URL::to('network/profile',$feed->user_id)); ?>"><?php echo e(ucwords($feed->username)); ?></a></strong> : <?php echo e($feed->feed_description); ?><br>
                     <?php elseif($feed->feed_type == 'recomend'): ?>
                        <strong><?php echo $feed->feed_title; ?></strong><br>
                     <?php endif; ?>
                     
                     <?php if($feed->feed_type != 'recomend'): ?>
                        <strong><a href="<?php echo e(URL::to('network/profile',$feed->user_id)); ?>"><?php echo e(ucwords($feed->username)); ?></a></strong><br>
                     <?php endif; ?>   
                  </span>

                  <?php if($feed->feed_type == 'share'): ?>
                     <p><?php echo e(ucfirst($feed->share_feed_title)); ?> <br />
                     <?php
                     $sanitized = htmlspecialchars($feed->share_feed_description, ENT_QUOTES);
					      echo str_replace(array("\r\n", "\n"), array("<br />", "<br />"), $sanitized);
                     ?></p>
                  <?php else: ?>
                     <p><strong><?php echo e(ucfirst($feed->feed_title)); ?></strong></p>
                     <p><?php
                     $sanitized = htmlspecialchars($feed->feed_description, ENT_QUOTES);
					      echo str_replace(array("\r\n", "\n"), array("<br />", "<br />"), $sanitized);
                     ?></p>
                  <?php endif; ?>
                  <div class="feed-links" id="feedLinksBlk<?php echo e($feed->id); ?>" data-id="<?php echo e(($feed->feed_type == 'share')? $feed->share_feed_id:$feed->id); ?>">
                     <?php /**/ $feedComCnt = $CComponent::feedComents($feed->id, 'count') /**/ ?>
                     <?php /**/ $fdLikes = $CComponent::feedLikes($feed->id, 'count') /**/ ?>
                     <?php /**/ $fdLikeCheck = $CComponent::feedLikes($feed->id, 'check') /**/ ?>
                     <span class="clsLike" data-url="<?php echo e(URL::to('network/ajxfeedlike')); ?>"><?php echo e($fdLikeCheck? 'Unlike':'Like'); ?></span> 
                     <span class="clsShare" data-url="<?php echo e(URL::to('network/ajxsharefeed')); ?>" data-toggle="modal" data-target="#popupfeedShare">Share</span> 
                     <span class="clsComments">Comment</span>
                     <span class="likes" data-likecnt="<?php echo e($fdLikes); ?>">
                        <i class="fa fa-thumbs-o-up"></i> <span><?php echo e($fdLikes); ?></span>
                     </span>
                     <span class="comments" data-comcnt="<?php echo e($feedComCnt); ?>">
                        <i class="fa fa-comment-o"></i> <span><?php echo e($feedComCnt); ?></span>
                     </span>
                  </div>
               </div>
               
               <?php /* Comments Section: Start */ ?>
               <div class="col-md-12 feed-info comments-block" id="feedComBlk<?php echo e($feed->id); ?>">
                  <?php /**/ $feedComments = $CComponent::feedComents($feed->id) /**/ ?>
                  <?php /**/ $feedCommentsCnt = $CComponent::feedComents($feed->id, 'count') /**/ ?>
                    
                  <?php if($feedCommentsCnt > 5): ?>   
                     <a data-url="<?php echo e(URL::to('network/ajxloadcomm')); ?>" data-pageno="1" data-feedid="<?php echo e($feed->id); ?>" href="javascript:void(0)" id="loadMoreComments<?php echo e($feed->id); ?>" class="load_more_comments">View previous comments</a>
                  <?php endif; ?>   

                  <div id="ajxLoadFeedCom<?php echo e($feed->id); ?>">
                     <?php if(count($feedComments) > 0): ?>
                        <?php 
                           $feedComments = json_decode(json_encode($feedComments),TRUE);
                           $feedComments = array_reverse($feedComments, true);
                        ?>
                        <?php foreach($feedComments as $comm): ?>
                           <?php /**/ $comm = (object)$comm /**/ ?>
                        <div class="col-md-12 padding-none form-control-fld">
                           
                           <div class="user-pic pull-left">
                              <?php if($comm->lkp_role_id == 2): ?>
               						<?php /**/ $url = "uploads/seller/$comm->userid/" /**/ ?>
               					<?php else: ?>
               						<?php /**/ $url = "uploads/buyer/$comm->userid/" /**/ ?>
               					<?php endif; ?>
               					<?php /**/ $getprofile = $url.$comm->user_pic /**/ ?>
               					<?php /**/ $userpic =  $commoncomponent::str_replace_last( '.' , '_40_40.' , $getprofile ) /**/ ?>
         			        
                             <a href="<?php echo e(URL::to('network/profile',$comm->comment_user_id)); ?>">
                              <?php if(file_exists($getprofile)): ?>
         			        	      <img src="<?php echo e(url($userpic)); ?>"/>
                              <?php else: ?>
                             	 <i class="fa fa-user"></i>
                              <?php endif; ?>
                             </a>
                           </div>

                           <span class="user-name pull-left">
                              <strong><a href="<?php echo e(URL::to('network/profile',$comm->comment_user_id)); ?>"><?php echo e(ucwords($comm->username)); ?></a> : </strong>
                              <span id="commentid_<?php echo e($comm->id); ?>"><?php echo e($comm->comments); ?></span>
                           </span>

                           <div class="comment-details pull-right">
                              <?php if($feed->created_by == Auth::User()->id || $comm->created_by == Auth::User()->id ): ?>
                              <a href="javascript:void(0)" data-target="#editpostcomment" data-toggle="modal" onclick="editcomment(<?php echo e($feed->id); ?>,<?php echo e($comm->id); ?>,<?php echo e($comm->created_by); ?>)" ><i class="fa fa-edit" title="Edit"></i></a>&nbsp;&nbsp;
                              <a href="javascript:void(0)" data-target="#cancelpostcomment" data-toggle="modal" onclick="cancelcomment(<?php echo e($comm->id); ?>,<?php echo e($comm->created_by); ?>)" ><i class="fa fa-trash" title="Delete"></i></a>&nbsp;&nbsp;
                              <?php elseif($feed->created_by == Auth::User()->id && $comm->created_by != Auth::User()->id ): ?>  
                                 <a href="javascript:void(0)" data-target="#cancelpostcomment" data-toggle="modal" onclick="cancelcomment(<?php echo e($comm->id); ?>,<?php echo e($comm->created_by); ?>)" ><i class="fa fa-trash" title="Delete"></i></a>&nbsp;&nbsp;
                              <?php endif; ?>
                              <?php echo e(date('d/m/Y',strtotime($comm->created_at))); ?>

                           </div>
                           
                           </div>
                        <?php endforeach; ?>
                     <?php endif; ?>   
                  </div>
                  <div class="col-md-12 padding-none" >
                     <input type="text" placeholder="Add a comment" class="form-control form-control1" name="txtFeedComment" id="txtFeedComment<?php echo e($feed->id); ?>" class="clsFeedComment" data-feedid="<?php echo e($feed->id); ?>" data-curuser="<?php echo e(Auth::User()->username); ?>" data-url="<?php echo e(URL::to('network/ajxpostcomment')); ?>" maxlength="200"><label id="lblErrComment<?php echo e($feed->id); ?>" class="error"></label>
                  </div>
               </div>
               <?php /* Comments Section: End */ ?>
            </div>
          </div>
            
         <?php endforeach; ?>   
         <?php /* ******************** End ********************* */ ?>
         </div>   
      <?php else: ?>
         <div class="text-center" id="noResults"> No results found </div>
      <?php endif; ?>   
      </div>

      <div class="article_navigation" style="display:none;">
         <?php
         $pagescount = $totalcount/5+1;
         if(request('q')):
            $currenturl = Request::fullUrl();
            $currenturl = $currenturl.'&ajax=1';
         else:
            $currenturl = Request::url();
            $currenturl = $currenturl.'?ajax=1';
         endif;
         
         for($iterator=1;$iterator<=$pagescount;$iterator++){
         ?>
         <a total="<?php echo e($totalcount); ?>" class="next" href="<?php echo e($currenturl); ?>&page=<?php echo $iterator; ?>">Next</a>
         <?php } ?>
      </div>
      <div id="loader" style="display: none;" style="text-align: center; display: none;" class="ias-spinner">
         <img src="data:image/gif;base64,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" style="display:inline">
         <em>Loading the next set of articles...</em>
      </div>

      <div class="clearfix"></div>
   </div>
</div>

<div class="modal fade" id="popupfeedShare" role="dialog">
   <div class="modal-dialog">
      <div class="modal-content"></div>
   </div>
</div>
<script type="text/javascript"><!-- 
var isFilterEnable = "<?php echo e(request('q')); ?>";
//-->
</script>